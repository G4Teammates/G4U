@using Client.Models
@model AllModel


@*
<div class="Image_Gallery">
    <div class="box">
        <span style="--i:1"><img src="~/image/game.jpg" /></span>
        <span style="--i:2"><img src="~/image/g4t.png" /></span>
        <span style="--i:3"><img src="~/image/g4t1.png" /></span>
        <span style="--i:4"><img src="~/image/bia.jpg" /></span>
        <span style="--i:5"><img src="~/image/game.jpg" /></span>
        <span style="--i:6"><img src="~/image/game.jpg" /></span>
        <span style="--i:7"><img src="~/image/game.jpg" /></span>
        <span style="--i:8"><<img src="~/image/game.jpg" /></span>
    </div>
</div>
 *@
<div id="g_id_onload"
     data-client_id="931532368031-fve5bfiu4t6uvu5laj3gq9fbj7okl43e.apps.googleusercontent.com"
     data-login_uri='/google-response'
     data-auto_prompt='false'>
</div>
<div id="carouselExampleInterval" class="carousel slide mt-4 w-100 h-100" data-bs-ride="carousel" style="border-radius:5px; margin: 0 auto; width: 80%;">
    <div class="carousel-inner">
        @if (Model.Product != null)
        {
            // Lọc và lấy 4 sản phẩm mới nhất theo CreatedAt
            var latestProducts = Model.Product
            .OrderByDescending(p => p.CreatedAt) // Sắp xếp theo CreatedAt từ mới đến cũ
            .Take(4); // Lấy 4 sản phẩm đầu tiên

            // Biến để kiểm tra xem sản phẩm đầu tiên có được đánh dấu là "active" không
            bool isFirstItem = true;

            foreach (var product in latestProducts)
            {
                <div class="carousel-item @(isFirstItem ? "active" : "")" data-bs-interval="3000" style="border-radius:5px;">
                    @if (product.Links != null)
                    {
                        string firstImageUrl = null; // Biến để lưu URL hình ảnh đầu tiên

                        foreach (var link in product.Links) // Lặp qua từng đối tượng LinkModel
                        {
                            if (link.Url.Contains("cloudinary"))
                            {
                                firstImageUrl = link.Url; // Lưu URL hình ảnh đầu tiên
                                break; // Thoát khỏi vòng lặp khi đã tìm thấy
                            }
                        }

                        // Hiển thị hình ảnh đầu tiên nếu có
                        if (firstImageUrl != null)
                        {
                            <div class="carousel-image-container">
                                <img src="@firstImageUrl" alt="Cloudinary Image" class="d-block w-100 carousel-image" />
                            </div>
                        }
                    }
                </div>

                // Đánh dấu item đầu tiên để thiết lập class "active"
                isFirstItem = false;
            }
        }
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>


<div class="gamemonth">
    <section class="header_section">
        <h1>Game Of The Month</h1>
    </section>
    <div class="wrapper_gamemonth">
        <div class="slider_gamemonth">
            <div class="container_gamemonth owl-carousel owl-theme">
                @if (Model.Product != null && Model.Product.Any(p => p.CreatedAt.Year == DateTime.UtcNow.Year && p.CreatedAt.Month == DateTime.UtcNow.Month))
                {
                    int count = 0;
                    foreach (var product in Model.Product.Where(p => p.CreatedAt.Year == DateTime.UtcNow.Year && p.CreatedAt.Month == DateTime.UtcNow.Month))
                    {
                        if (count >= 6) break; // Giới hạn hiển thị 5 sản phẩm đầu tiên
                        count++;

                        <div class="card_gamemonth item">
                            <div class="img_gamemonth">
                                @if (product.Links != null)
                                {
                                    string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;
                                    if (firstImageUrl != null)
                                    {
                                        <img src="@firstImageUrl" alt="Cloudinary Image" />
                                    }
                                }
                            </div>
                            <div class="info">
                                <span class="name">@product.Name</span>
                                <p class="about">@product.Description</p>
                            </div>
                            <div class="footeer_card">
                                <div class="btn_card">
                                    <button>Read more...</button>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="card_gamemonth item">
                        <div class="img_gamemonth">
                            <img src="~/Image/game.jpg" />
                        </div>
                        <div class="info">
                            <span class="name">Justin Laketimber</span>
                            <p class="about">Lorem ipsum dolor sit amet consectetur adipisicing elit....</p>
                        </div>
                        <div class="footeer_card">
                            <div class="btn_card">
                                <button>Read more...</button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>


<div class="gamefree row">
    <div class="row">
        <div class="col-9 col-sm-9 col-md-9 free-games-section">
            <i class="fa-solid fa-gift"></i>
            <span>Featured Discounts</span>
        </div>
        <div class="col-3 col-sm-3 col-md-3 view-more-section">
            <a class="view-more-button">
                View More
            </a>
        </div>
    </div>
    <div class="row" style="justify-content:space-around;">
        @if (Model.Product != null)
        {
            // Lọc sản phẩm có Discount > 0, sắp xếp giảm dần theo Discount và lấy 4 sản phẩm đầu tiên
            var topDiscountProducts = Model.Product
            .Where(p => p.Discount > 0)
            .OrderByDescending(p => p.Discount)
            .Take(4);

            foreach (var product in topDiscountProducts)
            {
                <div class="col-12 col-sm-12 col-md-3 card_other mt-4">
                    @if (product.Links != null)
                    {
                        string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;
                        if (firstImageUrl != null)
                        {
                            <img src="@firstImageUrl" alt="Cloudinary Image" />
                        }
                    }
                    <div class="info_other">
                        <h1>@product.Name</h1>
                        <p>@product.Description</p>
                        <a asp-controller="" asp-action="" class="btn_orther">Read More</a>
                    </div>
                </div>
            }
        }
    </div>
    <p>Discounts Now - Dec 10</p>
</div>

<div class="ortherproduct">
    <section class="header_section">
        <h1>Orther Product</h1>
    </section>

    <!-- Danh sách Nút Điều Hướng -->
    <div class="lisotherproduct_name row mt-3">
        <a class="col-6 col-sm-2 col-md-2" href="#foryou">For You</a>
        <a class="col-6 col-sm-2 col-md-2" href="#popular">Popular</a>
        <a class="col-4 col-sm-2 col-md-2" href="#free">Free</a>
        <a class="col-4 col-sm-2 col-md-2" href="#new">New</a>
        <a class="col-4 col-sm-2 col-md-2" href="#more">More</a>
    </div>






    <section id="popular" class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-1">
            <h3>Popular</h3>
            <a href="">View More</a>
        </div>
        <div class="wrapper_other">
            @if (Model.Product != null)
            {
                // Lấy 4 sản phẩm có số NumberOfViews cao nhất
                var topViewedProducts = Model.Product
                .Where(p => p.Interactions != null) // Kiểm tra xem Interactions có khác null không
                .OrderByDescending(p => p.Interactions.NumberOfViews) // Sắp xếp theo NumberOfViews
                .Take(4); // Lấy 4 sản phẩm đầu tiên

                foreach (var product in topViewedProducts)
                {
                    <div class="card_other mt-4">
                        @if (product.Links != null)
                        {
                            string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;
                            if (firstImageUrl != null)
                            {
                                <img src="@firstImageUrl" alt="Cloudinary Image" />
                            }
                        }
                        <div class="info_other">
                            <h1>@product.Name</h1>
                            <p>@product.Description</p>
                            <a asp-controller="" asp-action="" class="btn_orther">Read More</a>
                        </div>
                    </div>
                }
            }
        </div>
    </section>



    <section id="free" class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-1">
            <h3>Free</h3>
            <a href="">View More</a>
        </div>
        <div class="wrapper_other">
            @if (Model.Product != null)
            {
                // Lọc sản phẩm có Price = 0 và lấy 4 sản phẩm đầu tiên
                var freeProducts = Model.Product
                .Where(p => p.Price == 0)
                .Take(4);

                foreach (var product in freeProducts)
                {
                    <div class="card_other mt-4">
                        @if (product.Links != null)
                        {
                            // Tìm link ảnh đầu tiên từ Cloudinary
                            string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;

                            // Hiển thị ảnh đầu tiên nếu tồn tại
                            if (firstImageUrl != null)
                            {
                                <img src="@firstImageUrl" alt="Cloudinary Image" />
                            }
                        }
                        <div class="info_other">
                            <h1>@product.Name</h1>
                            <p>@product.Description</p>
                            <a asp-controller="" asp-action="" class="btn_orther">Read More</a>
                        </div>
                    </div>
                }
            }
        </div>
    </section>


    <section id="new" class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-1">
            <h3>New</h3>
            <a href="">View More</a>
        </div>
        <div class="wrapper_other">
            @if (Model.Product != null)
            {
                // Lọc và lấy 4 sản phẩm có CreatedAt mới nhất
                var latestProducts = Model.Product
                .OrderByDescending(p => p.CreatedAt) // Sắp xếp theo CreatedAt giảm dần
                .Take(4); // Lấy 4 sản phẩm đầu tiên

                foreach (var product in latestProducts)
                {
                    <div class="card_other mt-4">
                        @if (product.Links != null)
                        {
                            string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;

                            // Hiển thị hình ảnh đầu tiên nếu có
                            if (firstImageUrl != null)
                            {
                                <img src="@firstImageUrl" alt="Cloudinary Image" />
                            }
                        }
                        <div class="info_other">
                            <h1>@product.Name</h1>
                            <p>@product.Description</p>
                            <a asp-controller="" asp-action="" class="btn_orther">Read More</a>
                        </div>
                    </div>
                }
            }
        </div>
    </section>


    <section id="more" class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-1">
            <h3>More</h3>
            <a href="">View More</a>
        </div>
        <div class="wrapper_other">
            @if (Model.Product != null)
            {
                foreach (var product in Model.Product)
                {
                    <div class="card_other mt-4">
                        @if (product.Links != null)
                        {
                            string firstImageUrl = null; // Biến để lưu URL hình ảnh đầu tiên

                            foreach (var link in product.Links) // Lặp qua từng đối tượng LinkModel
                            {
                                if (link.Url.Contains("cloudinary"))
                                {
                                    firstImageUrl = link.Url; // Lưu URL hình ảnh đầu tiên
                                    break; // Thoát khỏi vòng lặp khi đã tìm thấy
                                }
                            }

                            // Hiển thị hình ảnh đầu tiên nếu có
                            if (firstImageUrl != null)
                            {
                                <img src="@firstImageUrl" alt="Cloudinary Image" />
                            }


                        }
                        <div class="info_other">
                            <h1>@product.Name</h1>
                            <p>@product.Description</p>
                            <a asp-controller="" asp-action="" class="btn_orther">Read More</a>
                        </div>
                    </div>
                }
            }
        </div>
    </section>
</div>
<div class="best-seller_most-player_top-upcoming-wishlisted row mt-5">
    <div class="col-12 col-sm-12 col-md-4 mt-3" style="border-right:1px solid black;border-left:1px solid black;">
        <h2>
            <a href="" style="text-decoration:none;color:black;">Top Sellers <i class="fa-solid fa-angle-right"></i></a>
        </h2>
        <div class="row">
            @if (Model.Product != null)
            {
                // Lọc sản phẩm, sắp xếp giảm dần theo số lượng đã bán và lấy 4 sản phẩm đầu tiên
                var topSoldProducts = Model.Product
                .OrderByDescending(p => p.Sold)
                .Take(4);

                foreach (var product in topSoldProducts)
                {
                    <div class="col-4 col-sm-4 col-md-4 mt-3">
                        @if (product.Links != null)
                        {
                            string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;
                            if (firstImageUrl != null)
                            {
                                <div style="width: 100%;height: 70px;overflow: hidden;display: flex;align-items: center;justify-content: center;">
                                    <img src="@firstImageUrl" alt="Cloudinary Image" style=" width: 100%;height: 100%;object-fit: cover;" />
                                </div>

                                
                            }
                        }
                    </div>
                    <div class="col-8 col-sm-8 col-md-8 mt-3">
                        @product.Name
                    </div>
                }
            }
        </div>
    </div>

    <div class="col-12 col-sm-12 col-md-4 mt-3" style="border-right:1px solid black;border-left:1px solid black;">
        <h2>
            <a href="" style="text-decoration:none;color:black;">Most Played<i class="fa-solid fa-angle-right"></i></a>
        </h2>
        <div class="row">
            @if (Model.Product != null)
            {
                // Lọc sản phẩm có InteractionModel và sắp xếp theo NumberOfLikes, lấy 4 sản phẩm đầu tiên
                var topLikedProducts = Model.Product
                .Where(p => p.Interactions != null) // Đảm bảo InteractionModel không null
                .OrderByDescending(p => p.Interactions.NumberOfLikes)
                .Take(4);

                foreach (var product in topLikedProducts)
                {
                    <div class="col-4 col-sm-4 col-md-4 mt-3">
                        @if (product.Links != null)
                        {
                            string firstImageUrl = product.Links.FirstOrDefault(link => link.Url.Contains("cloudinary"))?.Url;
                            if (firstImageUrl != null)
                            {
                                <div style="width: 100%;height: 70px;overflow: hidden;display: flex;align-items: center;justify-content: center;">
                                    <img src="@firstImageUrl" alt="Cloudinary Image" class="img-fluid img-thumbnail" style=" width: 100%;height: 100%;object-fit: cover;" />
                                </div>
                            }
                        }
                    </div>
                    <div class="col-8 col-sm-8 col-md-8 mt-3">
                        @product.Name
                    </div>
                }
            }
        </div>
    </div>

    <div class="col-12 col-sm-12 col-md-4 mt-3" style="border-right:1px solid black;border-left:1px solid black;">
        <h2>
            <a href="" style="text-decoration:none;color:black;">Top Upcoming Wishlisted <i class="fa-solid fa-angle-right"></i></a>
        </h2>
        <div class="row">
            @if (Model.Product != null)
            {
                foreach (var product in Model.Product)
                {
                    <div class="col-4 col-sm-4 col-md-4 mt-3">
                        @if (product.Links != null)
                        {
                            string firstImageUrl = null; // Biến để lưu URL hình ảnh đầu tiên

                            foreach (var link in product.Links) // Lặp qua từng đối tượng LinkModel
                            {
                                if (link.Url.Contains("cloudinary"))
                                {
                                    firstImageUrl = link.Url; // Lưu URL hình ảnh đầu tiên
                                    break; // Thoát khỏi vòng lặp khi đã tìm thấy
                                }
                            }

                            // Hiển thị hình ảnh đầu tiên nếu có
                            if (firstImageUrl != null)
                            {
                                <div style="width: 100%;height: 70px;overflow: hidden;display: flex;align-items: center;justify-content: center;">
                                    <img src="@firstImageUrl" alt="Cloudinary Image" style=" width: 100%;height: 100%;object-fit: cover;" />
                                </div>

                            }


                        }
                    </div>
                    <div class="col-8 col-sm-8 col-md-8 mt-3">
                        @product.Name
                    </div>
                }
            }


        </div>

    </div>
</div>


<!-- Nút Scroll to Top -->
<button id="scrollToTopBtn" title="Go to top">
    <i class="fa-solid fa-chevron-up"></i>
</button>




@{
    string isLoginSuccess = "false";
    if (ViewData["IsLogin"] != null)
    {
        isLoginSuccess = ViewData["IsLogin"].ToString();
    }
}
<script>
    // Cấu hình Google One Tap
    window.onload = function () {
        // google.accounts.id.initialize({
        //     client_id: '931532368031-fve5bfiu4t6uvu5laj3gq9fbj7okl43e.apps.googleusercontent.com',
        //     context: 'signin',
        //     login_uri: "/google-response",
        //     auto_prompt: false
        // });

        // Kiểm tra trạng thái đăng nhập từ biến Razor
        var isLoginSuccess = @Html.Raw(isLoginSuccess.ToString().ToLower());

        // Nếu trạng thái chưa đăng nhập thành công, hiển thị Google One Tap
        if (isLoginSuccess === false) { // Sử dụng so sánh === để so sánh giá trị
            google.accounts.id.prompt();  // Hiển thị Google One Tap nếu người dùng chưa đăng nhập
        } else {
            google.accounts.id.cancel();  // Tắt Google One Tap nếu đã đăng nhập
        }
    };
</script>