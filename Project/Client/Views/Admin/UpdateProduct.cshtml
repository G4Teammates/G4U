@model Client.Models.ProductDTO.ProductModel
@{
    ViewData["Title"] = "Update Product";
}
@{
    Layout = "_LayoutAdmin";
}
<h2>Update Product</h2>

<form asp-action="UpdateProduct" method="post" enctype="multipart/form-data">
    <input type="hidden" name="_method" value="PUT" /> <!-- Giả lập PUT method -->
    <!-- Các trường cơ bản của sản phẩm -->
    <div class="form-group">
        <label for="id">Product ID</label>
        <input type="text" class="form-control" asp-for="Id" readonly />
    </div>

    <div class="form-group">
        <label for="name">Product Name</label>
        <input type="text" class="form-control" asp-for="Name" required />
    </div>

    <div class="form-group">
        <label for="description">Description</label>
        <textarea class="form-control" asp-for="Description" rows="4" required></textarea>
    </div>

    <!-- Cập nhật các danh mục sản phẩm -->
    <div class="form-group">
        <label>Categories</label>
        <div id="categories-list">
            @if (Model.Categories != null && Model.Categories.Any())
            {
                int i = 0;
                @foreach (var category in Model.Categories)
                {
                    <div class="input-group mb-2">
                        <input type="text" name="Categories[@i].CategoryName" value="@category.CategoryName" class="form-control" />
                        <div class="input-group-append">
                            <button type="button" class="btn btn-danger" onclick="removeCategory(this)">Remove</button>
                        </div>
                    </div>
                    i++;
                }
            }
        </div>
        <button type="button" class="btn btn-success" onclick="addCategory()">Add Category</button>
    </div>

    <!-- Cập nhật các đường dẫn (Links) -->
    <div class="form-group">
        <label>Images and Game</label>
        <div id="links-list">
            @if (Model.Links != null)
            {
                int i = 0;
                @foreach (var link in Model.Links)
                {
                    <div class="input-group mb-2">
                        @if (link.Url.Contains("cloudinary"))
                        {
                            <label>Images</label>
                            <img src="@link.Url" alt="Cloudinary Image" style="max-width: 150px; height: auto;" />
                        }
                        else if (link.Url.Contains("drive.google.com"))
                        {
                            <label>Game</label>
                            <a href="@link.Url" target="_blank">View on Google Drive</a>
                        }
                        else
                        {
                            <a href="@link.Url" target="_blank">@link.Url</a>
                        }

                        <input type="text" name="Links[@i].Url" value="@link.Url" class="form-control mt-2" />
                        <div class="input-group-append">
                            <button type="button" class="btn btn-danger" onclick="removeLink(this)">Remove</button>
                        </div>
                    </div>
                    i++;
                }
            }
        </div>
        <button type="button" class="btn btn-success" onclick="addLink()">Add Link</button>
    </div>

    <!-- Upload hình ảnh và file game -->
    <div class="form-group">
        <label for="imageFiles">Upload Images</label>
        <input type="file" class="form-control" name="imageFiles" multiple />
    </div>

    <div class="form-group">
        <label for="gameFile">Upload Game File</label>
        <input type="file" class="form-control" name="request.gameFile" />
    </div>

    <button type="submit" class="btn btn-primary">Update Product</button>
    <a asp-action="ProductsManager" class="btn btn-secondary">Back To List</a>
</form>

<!-- JavaScript để thêm/xóa Categories và Links -->
@section Scripts {
    <script type="text/javascript">
        let categoryIndex = @Model.Categories?.Count() ?? 0;
        let linkIndex = @Model.Links?.Count() ?? 0;

        function addCategory() {
            let html = `<div class="input-group mb-2">
                                    <input type="text" name="Categories[${categoryIndex}].CategoryName" class="form-control" />
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-danger" onclick="removeCategory(this)">Remove</button>
                                    </div>
                                </div>`;
            $('#categories-list').append(html);
            categoryIndex++;
        }

        function removeCategory(button) {
            $(button).closest('.input-group').remove();
        }

        function addLink() {
            let html = `<div class="input-group mb-2">
                                    <input type="text" name="Links[${linkIndex}].Url" class="form-control" />
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-danger" onclick="removeLink(this)">Remove</button>
                                    </div>
                                </div>`;
            $('#links-list').append(html);
            linkIndex++;
        }

        function removeLink(button) {
            $(button).closest('.input-group').remove();
        }
    </script>
}
